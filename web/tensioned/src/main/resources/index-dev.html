<!DOCTYPE html>
<head>
  <meta http-equiv="Content-Language" content="en">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="UTF-8">
  <title>DiBL - Dynamic bobbin lace working diagrams for grounds</title>
  <style>
    fieldset { display: inline-block }
    input { width: 3em; }
    #pattern { width: 6em; }
    .link { stroke: #000; }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script src="https://raw.githubusercontent.com/jo-pol/DiBL/gh-pages/tensioned/sample.js"></script>
  <script src="https://raw.githubusercontent.com/jo-pol/DiBL/gh-pages/tensioned/show-graph.js"></script>
  <script type="text/javascript" src="../dibl-tensioned-fastopt.js"></script>
  <script type="text/javascript" src="/workbench.js"></script>
  <script>
    fullyTransparant = 0.1

    function showNr(form) {
      document.getElementById('diagram').innerHTML = ""
      var data = dibl.D3Data().getNr(form.set.value, form.nrInSet.value * 1,
                                   form.rows.value * 1, form.cols.value * 1,
                                   form.shiftLeft.value * 1, form.shiftUp.value * 1)
      showGraph({
        threadColor: '#colorpicker',
        container: '#diagram',
        width: 1000,
        height: 800,
        nodes: data.nodes,
        links: data.links,
      })
    }

    function showStr(form) {
      document.getElementById('diagram').innerHTML = ""
      var data = dibl.D3Data().getStr(form.set.value, form.pattern.value,
                                   form.rows.value * 1, form.cols.value * 1,
                                   form.shiftLeft.value * 1, form.shiftUp.value * 1)
      showGraph({
        threadColor: '#colorpicker',
        container: '#diagram',
        width: 1000,
        height: 800,
        nodes: data.nodes,
        links: data.links,
      })
    }

    function setMax(form) {
      form.nrInSet.max = form.set[form.set.selectedIndex].getAttribute("data-max-nr")
    }
  </script>
</head>
<body onload="showNr(document.getElementById('graph'))">
  <form id="graph" action="" onsubmit="return false">
    <fieldset id="shift">
      <label for="shiftLeft">left by </label>
      <input id="shiftLeft" name="shiftLeft" min="0" max="3" value="1" type="number"/>
      <label for="shiftUp">up by </label>
      <input id="shiftUp" name="shiftUp" min="0" max="3" value="0" type="number"/>
    </fieldset>
    <fieldset>
      <label for="rows">rows</label>
      <input id="rows" name="rows" min="0" max="40" value="14" type="number"/>
      <label for="cols">columns</label>
      <input id="cols" name="cols" min="0" max="20" value="7" type="number"/>
    </fieldset>
    <select size="1" id="set" name="set" onChange="setMax(form)">
      <option data-max-nr="0" value="2x4 rose ground" selected>rose ground</option>
      <option data-max-nr="16">2x2</option>
      <option data-max-nr="92">4x2</option>
      <option data-max-nr="46">2x4</option>
    </select>
    <label for="nrInSet">nr</label>
    <input id="nrInSet" name="nrInSet" min="0" max="0" value="0" type="number" onchange="this.form.pattern = "/>
    <button class="button" type="submit" onclick="showNr(this.form)">draw</button>
    <label for="pattern">free pattern</label>
    <input id="pattern" name="pattern" type="text" pattern="[-0-9]+" value="46636668"/>
    <button class="button" type="submit" onclick="showStr(this.form)">draw</button>
  </form>
  <form id="color" action="" onsubmit="return false;" style="visibility: hidden;">
    <!-- test this one in gh-pages branch, omitting it would break the showGraph function -->
    <input id="colorpicker" type="text" class="color" value="#CC0000"/>
  </form>
  <div id="diagram"></div>
</body>